<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>管理员后台 | 英语单词网站</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "微软雅黑"; }
    .container { max-width: 1000px; margin: 50px auto; padding: 20px; }
    h2 { color: #3498db; margin-bottom: 20px; text-align: center; }
    .login-box { text-align: center; margin-bottom: 30px; }
    #adminPwd { padding: 10px; width: 200px; border: 1px solid #ddd; border-radius: 6px; }
    #loginBtn { padding: 10px 25px; background: #3498db; color: white; border: none; border-radius: 6px; cursor: pointer; margin-left: 10px; }
    #loginBtn:hover { background: #2980b9; }

    /* 统计面板样式 */
    .stats-container {
      display: none;
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #eee;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    .stats-card {
      background: white;
      padding: 15px;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }
    .stats-card h3 {
      color: #666;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .stats-card .num {
      font-size: 24px;
      font-weight: bold;
      color: #3498db;
    }
    .stats-subtitle {
      color: #333;
      margin: 15px 0 10px 0;
      font-size: 16px;
      border-bottom: 1px solid #eee;
      padding-bottom: 5px;
    }
    .daily-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #eee;
    }

    /* 数据表格样式 */
    table { width: 100%; border-collapse: collapse; display: none; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
    th { background: #f5f5f5; color: #333; }
    tr:nth-child(even) { background: #f9f9f9; }
  </style>
</head>
<body>
  <div class="container">
    <h2>访客单词需求管理后台</h2>
    <div class="login-box">
      <input type="password" id="adminPwd" placeholder="输入管理员密码">
      <button id="loginBtn" onclick="login()">登录查看</button>
    </div>

    <!-- 统计面板（访问量+提交量） -->
    <div class="stats-container" id="statsContainer">
      <!-- 访问量统计 -->
      <h3 class="stats-subtitle">网站访问量统计（独立访客）</h3>
      <div class="stats-grid">
        <div class="stats-card">
          <h3>总访问人数</h3>
          <div class="num" id="totalVisits">0</div>
        </div>
        <div class="stats-card">
          <h3>今日访问人数</h3>
          <div class="num" id="todayVisits">0</div>
        </div>
        <div class="stats-card">
          <h3>本周访问人数</h3>
          <div class="num" id="weekVisits">0</div>
        </div>
      </div>

      <!-- 提交量统计 -->
      <h3 class="stats-subtitle">单词提交量统计</h3>
      <div class="stats-grid">
        <div class="stats-card">
          <h3>总提交量</h3>
          <div class="num" id="totalSubmit">0</div>
        </div>
        <div class="stats-card">
          <h3>今日提交量</h3>
          <div class="num" id="todaySubmit">0</div>
        </div>
        <div class="stats-card">
          <h3>本周提交量</h3>
          <div class="num" id="weekSubmit">0</div>
        </div>
      </div>

      <!-- 近7天提交明细 -->
      <h3 class="stats-subtitle">近7天提交明细</h3>
      <div id="dailyList"></div>
    </div>

    <!-- 提交数据表格 -->
    <table id="dataTable">
      <tr><th>ID</th><th>想学习的单词</th><th>访客IP</th><th>提交时间</th></tr>
      <tbody id="requestList"></tbody>
    </table>
  </div>

  <script>
    let password = ''; // 存储登录密码

    // 统一登录函数
    async function login() {
      password = document.getElementById('adminPwd').value;
      if (!password) {
        alert('请输入管理员密码！');
        return;
      }
      
      // 先获取访问量统计
      await getVisitStats();
      // 再获取提交量统计
      await getSubmitStats();
      // 最后获取提交数据列表
      await getRequests();
    }

    // 1. 获取访问量统计（独立访客）
    async function getVisitStats() {
      try {
        const res = await fetch(`https://submit.mzc0603.xyz/get-visit-stats?password=${encodeURIComponent(password)}`);
        if (res.status === 403) {
          alert('密码错误！');
          return;
        }
        const data = await res.json();
        
        // 显示统计面板
        document.getElementById('statsContainer').style.display = 'block';
        // 更新访问量数据
        document.getElementById('totalVisits').textContent = data.total_visits;
        document.getElementById('todayVisits').textContent = data.today_visits;
        document.getElementById('weekVisits').textContent = data.week_visits;
      } catch (err) {
        alert('获取访问量数据失败！');
        console.log(err);
      }
    }

    // 2. 获取提交量统计
    async function getSubmitStats() {
      try {
        const res = await fetch(`https://submit.mzc0603.xyz/get-stats?password=${encodeURIComponent(password)}`);
        const data = await res.json();
        
        // 更新提交量数据
        document.getElementById('totalSubmit').textContent = data.total;
        document.getElementById('todaySubmit').textContent = data.today;
        document.getElementById('weekSubmit').textContent = data.week;

        // 渲染近7天提交明细
        const dailyList = document.getElementById('dailyList');
        dailyList.innerHTML = '';
        if (data.daily.length === 0) {
          dailyList.innerHTML = '<div>暂无数据</div>';
          return;
        }
        data.daily.forEach(item => {
          const div = document.createElement('div');
          div.className = 'daily-item';
          div.innerHTML = `
            <span>${item.date_str}</span>
            <span>${item.count} 次提交</span>
          `;
          dailyList.appendChild(div);
        });
      } catch (err) {
        alert('获取提交量数据失败！');
        console.log(err);
      }
    }

    // 3. 获取所有提交数据列表
    async function getRequests() {
      try {
        const res = await fetch(`https://submit.mzc0603.xyz/get-requests?password=${encodeURIComponent(password)}`);
        const data = await res.json();
        
        document.getElementById('dataTable').style.display = 'block';
        const list = document.getElementById('requestList');
        list.innerHTML = '';
        if (data.length === 0) {
          const tr = document.createElement('tr');
          tr.innerHTML = '<td colspan="4">暂无访客提交的需求</td>';
          list.appendChild(tr);
          return;
        }
        data.forEach(item => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${item.id}</td>
            <td>${item.word}</td>
            <td>${item.ip}</td>
            <td>${item.create_time}</td>
          `;
          list.appendChild(tr);
        });
      } catch (err) {
        alert('获取提交数据失败，请稍后再试！');
        console.log(err);
      }
    }
  </script>
</body>
</html>
